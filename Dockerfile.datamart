FROM spark:3.5.6-scala2.12-java17-python3-ubuntu

WORKDIR /opt/app

COPY datamart/target/scala-2.12/DataMart-assembly-1.0.jar .

CMD ["/opt/spark/bin/spark-submit", \
     "--class", "DataMartServer", \
     "--master", "k8s://https://kubernetes.default.svc:443", \
     "--conf", "spark.kubernetes.namespace=default", \
     "--conf", "spark.kubernetes.authenticate.driver.serviceAccountName=spark", \
     "--conf", "spark.kubernetes.container.image=spark:3.5.6-scala2.12-java17-python3-ubuntu", \
     "--conf", "spark.jars.packages=org.mongodb.spark:mongo-spark-connector_2.12:10.5.0", \
     "local:///opt/app/DataMart-assembly-1.0.jar"]